# 问题

当前查询优化器使用简化假设的基数估计。因此基数估计可能会出现错误，并导致执行计划次优。

现有的基数估计（CE）benchmark提供了一组针对真实数据集的select-project-join查询，然而：

* 查询不够复杂，不能满足真实需求
* 需要进一步调查优化器对基数估计错误的容错率
* 现代优化器的运行时技术会掩盖基数估计的不利影响，这种影响还缺乏评估

# 想法

* 通过比较数据库原始查询计划的执行时间和使用**精确的基数估计方式**得到的执行时间，来量化基数估计的影响，具体来说， $impact = \frac{估计时间}{精确时间}$

# 方案

* 使用多个benchmark来覆盖种类更多的SQL查询，评估更多种类的数据库(行存储、列存储)
* 对于所有具有较大改进的查询，分析查询计划的具体改进（查找运算符、扫描运算符、非叶运算符等）
* 引入q-error制造误差
* 重点分析两种技术：位图过滤技术、自适应join

# 结论

* 注入准确的基数估计（CE）对查询计划的影响显示，70%的查询影响在0.8倍到1.2倍之间，即这些查询的改进或退步幅度小于20%。其中，8%的查询改进了2倍到10倍，3%的查询改进了10倍到100倍，而2%的查询改进了超过100倍
* 对于那些改进2倍或更多的查询，改进的主要原因包括：避免了昂贵的索引查找操作，扫描操作，以及在某些情况下选择了更好的连接顺序或连接方法
* 尽管大多数查询显示了改进，少数查询显示了性能退步，这通常是由于优化器的成本模型不准确导致的
* 在列存储配置中，注入准确CE对计划质量的影响类似于行存储。然而，不同工作负载之间的影响差异更大。改进类别的分析显示，与行存储相比，列存储中改进的查询大多数属于扫描操作或非叶运算类别。
